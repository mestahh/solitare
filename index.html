<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solitare</title>
    <link rel="stylesheet" href="style.css">

</head>

<body>
    <header>
        <h1>Solitare</h1>
    </header>
    <main>
        <section id="main-top">
            <div class="foundation">
                <div class="foundation-column">
                    <div class="card-wrapper">
                        Jack
                    </div>
                </div>
                <div class="foundation-column">
                    <div class="card-wrapper">
                        Queen
                    </div>
                </div>
                <div class="foundation-column">
                    <div class="card-wrapper">
                        Ace
                    </div>
                </div>
                <div class="foundation-column">
                    <div class="card-wrapper">
                        King
                    </div>
                </div>
            </div>
            <div class="deck">
                deck
            </div>
        </section>
        <section id="tableau">
            <div class="tableau-column">
                <div class="empty-card" ondrop="drop(event, this)" ondragover="allowDrop(event)">
                    Empty card
                </div>
                <div class="card-wrapper" ondrop="drop(event, this)" ondragover="allowDrop(event)" draggable="true"
                    ondragstart="dragStart(event, this)" id="card1">
                    <div class="card-wrapper-inner">
                        <div class="card-front">
                            <img src="img/cards/king_of_clubs.png" alt="Avatar">
                        </div>
                        <div class="card-back">
                            <img src="img_avatar.png" alt="Avatar">
                        </div>
                    </div>
                </div>
            </div>
            <div class="tableau-column">
                <div class="empty-card" ondrop="drop(event, this)" ondragover="allowDrop(event)">
                    Empty card
                </div>
                <div class="card-wrapper" ondrop="drop(event, this)" ondragover="allowDrop(event)" draggable="true"
                    ondragstart="dragStart(event, this)" id="card2">
                    <div class="card-wrapper-inner reversed">
                        <div class="card-front">
                            <img src="img/cards/5_of_diamonds.png" alt="Avatar">
                        </div>
                        <div class="card-back">
                            <img src="img_avatar.png" alt="Avatar">
                        </div>
                    </div>
                </div>
                <div class="card-wrapper" ondrop="drop(event, this)" ondragover="allowDrop(event)" draggable="true"
                    ondragstart="dragStart(event, this)" id="card3">
                    <div class="card-wrapper-inner">
                        <div class="card-front">
                            <img src="img/cards/jack_of_clubs.png" alt="Avatar">
                        </div>
                        <div class="card-back">
                            <img src="img_avatar.png" alt="Avatar">
                        </div>
                    </div>
                </div>
            </div>
        </section>


    </main>
    <script>
        function drop(e, el) {
            e.preventDefault();
            const id = e.dataTransfer.getData('text/plain');
            const draggable = document.getElementById(id);
            el.parentElement.appendChild(draggable);

            indexCards();
        }

        function dragStart(e, element) {
            e.dataTransfer.setData('text/plain', element.id);
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function indexCards() {
            const columns = document.querySelectorAll('.tableau-column');

            columns.forEach((el) => {
                const cards = el.querySelectorAll('.card-wrapper-inner');

                const numberOfCards = cards.length;
                cards.forEach((card, index) => {
                    card.parentElement.style.setProperty('--custom-index', index % numberOfCards);
                    if (index == numberOfCards - 1) {
                        card.classList.remove('reversed');
                    }
                    if (!card.classList.contains('revealed')) {
                        card.setAttribute('draggable', 'true');
                    }
                });

            })
        }

        indexCards();
    </script>
</body>

</html>